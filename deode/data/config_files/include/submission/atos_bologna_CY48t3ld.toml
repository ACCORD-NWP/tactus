bindir = "/home/snh02/pack/48t3_fix.04.OMPIIFC2104.x/bin"
submit_types = ["background_vm", "background_hpc", "serial", "parallel"]
default_submit_type = "serial"

[task]
wrapper = ""

[background_vm]
INTERPRETER = "#!/usr/bin/python3"
SCHOST = "localhost"
tasks = ["Background_vm"]

[background_hpc]
SCHOST = "localhost"
tasks = ["creategrib", "Background_hpc", "UnitTest"]

[serial]
SCHOST = "hpc"
NPROC = 1
NPROCX = 1
NPROCY = 1
WRAPPER = "srun"
tasks = ["Gmted", "Soil", "Marsprep", "MarsprepGlobalDT"]

[serial.BATCH]
NAME = "#SBATCH --job-name=@TASK_NAME@"
ACCOUNT = "#SBATCH -A msdeode"
WALLTIME = "#SBATCH --time=00:15:00"
QOS = "#SBATCH --qos=nf"
NODES = "#SBATCH --nodes=1"
NTASKS= "#SBATCH --ntasks=1"

[serial.ENV]
OS = "import os"
MODULE_ENV= "exec(open('/usr/local/apps/lmod/8.6.8/init/env_modules_python.py').read())"
MODULE_INTEL= "module('load', 'prgenv/intel')"
MODULE_MKL= "module('load', 'intel-mkl/19.0.5')"
MODULE_OPENMPI= "module('load', 'hpcx-openmpi/2.9.0')"
MODULE_NETCDF4= "module('load', 'netcdf4/4.7.4')"
MODULE_HDF5= "module('load', 'hdf5/1.10.6')"
MODULE_ECMWF= "module('load', 'ecmwf-toolbox/2021.08.3.0')"
MODULE_FFTW= "module('load', 'fftw/3.3.9')"
OMP_NUM_THREADS= "os.environ['OMP_NUM_THREADS'] = '1'"
OMPI_MCA_btl= "os.environ['OMPI_MCA_btl'] = '^vader'"
DR_HOOK_SIGNALS = "os.environ['DR_HOOK_IGNORE_SIGNALS'] = '-1'"
MARS_READANY_BUFFER_SIZE= "os.environ['MARS_READANY_BUFFER_SIZE'] = '78930200'"

[task_exceptions.PgdUpdate]
bindir = "/home/snh02/work/gl_binaries"
binary = "gl_20230823"

[task_exceptions.creategrib]
bindir = "/home/snh02/work/gl_binaries"
binary = "gl_20230823"

[task_exceptions.Gmted.ENV]
MODULE_GDAL= "module('load', 'gdal/3.2.1')"

[task_exceptions.Soil.ENV]
MODULE_GDAL= "module('load', 'gdal/3.2.1')"

[parallel]
SCHOST = "hpc"
tasks = ["Forecast", "e927", "Pgd", "Prep", "c903"]
NPROC = 32
WRAPPER = "srun"
[parallel.BATCH]
NAME = "#SBATCH --job-name=@TASK_NAME@"
ACCOUNT = "#SBATCH -A msdeode"
WALLTIME = "#SBATCH --time=00:10:00"
QOS = "#SBATCH --qos=np"

[parallel.ENV]
OS = "import os"
MODULE_ENV= "exec(open('/usr/local/apps/lmod/8.6.8/init/env_modules_python.py').read())"
MODULE_INTEL= "module('load', 'prgenv/intel')"
MODULE_MKL= "module('load', 'intel-mkl/19.0.5')"
MODULE_OPENMPI= "module('load', 'hpcx-openmpi/2.9.0')"
MODULE_NETCDF4= "module('load', 'netcdf4/4.7.4')"
MODULE_HDF5= "module('load', 'hdf5/1.10.6')"
MODULE_ECMWF= "module('load', 'ecmwf-toolbox/2021.08.3.0')"
MODULE_FFTW= "module('load', 'fftw/3.3.9')"
OMP_NUM_THREADS= "os.environ['OMP_NUM_THREADS'] = '1'"
DR_HOOK = "os.environ['DR_HOOK'] = '1'"
DR_HOOK_SIGNALS = "os.environ['DR_HOOK_IGNORE_SIGNALS'] = '-1'"
OMPI_MCA_btl= "os.environ['OMPI_MCA_btl'] = '^vader'"

[task_exceptions.e927]
NPROC = 16

[task_exceptions.e927.BATCH]
NODES = "#SBATCH --nodes=1"
NTASKS = "#SBATCH --ntasks=16"

[task_exceptions.Forecast]
NPROC = 64

[task_exceptions.Forecast.BATCH]
NODES = "#SBATCH --nodes=8"
NTASKS = "#SBATCH --ntasks=64"
WALLTIME = "#SBATCH --time=01:00:00"
MEM = "#SBATCH --mem=200GB"

[task_exceptions.Pgd]
WRAPPER="srun -n @NPROC@"
[task_exceptions.Pgd.BATCH]
NODES = "#SBATCH --nodes=2"
NTASKS = "#SBATCH --ntasks=32"
WALLTIME = "#SBATCH --time=00:30:00"

[task_exceptions.Prep]
WRAPPER="srun -n @NPROC@"
[task_exceptions.Prep.BATCH]
NODES = "#SBATCH --nodes=1"
NTASKS = "#SBATCH --ntasks=1"
WALLTIME = "#SBATCH --time=00:10:00"

[task_exceptions.c903]
NPROC = 36
[task_exceptions.c903.BATCH]
NODE = "#SBATCH --nodes=12"
NTASKS = "#SBATCH --ntasks=36"
MEM = "#SBATCH --mem=200GB" 
WALLTIME = "#SBATCH --time=00:30:00" 

[task_exceptions.marsprep.BATCH]
NODES = "#SBATCH --nodes=1"
NTASKS = "#SBATCH --ntasks=1"
WALLTIME = "#SBATCH --time=01:00:00"

[task_exceptions.MarsprepGlobalDT.BATCH]
NODES = "#SBATCH --nodes=1"
NTASKS = "#SBATCH --ntasks=1"
WALLTIME = "#SBATCH --time=01:00:00"
