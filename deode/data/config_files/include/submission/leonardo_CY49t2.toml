bindir = "/leonardo/home/userexternal/dhaumont/gpupack/pack/49t2_alaro_gpu.01.NVHPC2311.1d/bin"
#bindir = "/leonardo_scratch/fast/DestE_340_24/dhaumont/gpupack/pack/49t2_openacc.01.NVHPC2311.1d/bin"
default_submit_type = "parallel"
lfftw = false
module_initpath = "/leonardo/pub/userexternal/dhaumont/install/lmod/lmod/init"
nproma = -32

submit_types = ["background_vm", "background_hpc", "serial", "parallel", "gnu"]

[background_hpc]
  SCHOST = "localhost"
  tasks = ["Background_hpc", "UnitTest"]

[background_vm]
  INTERPRETER = "#!/usr/bin/python3"
  SCHOST = "localhost"
  tasks = ["Background_vm"]

[gnu]
  NPROC = 1
  NPROCX = 1
  NPROCY = 1
  SCHOST = "hpc"
  tasks = ["ExtractSQLite"]
  WRAPPER = "srun"

[gnu.BATCH]
  NAME = "#SBATCH --job-name=@TASK_NAME@"
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=1"
  QOS = "#SBATCH --qos=nf"
  WALLTIME = "#SBATCH --time=00:15:00"

[gnu.MODULES]
  ECMWFTOOLBOX = ["load", "ecmwf-toolbox/2021.08.3.0"]

[parallel]
  NPROC = 8
  SCHOST = "leonardo"
  tasks = ["Forecast", "e927", "Pgd", "Prep", "c903"]
  WRAPPER = "srun"
[parallel.BATCH]
  NAME = "#SBATCH --job-name=@TASK_NAME@"
  QOS = "#SBATCH --qos=np"
  WALLTIME = "#SBATCH --time=00:10:00"

[parallel.ENV]
  DR_HOOK = 1
  DR_HOOK_IGNORE_SIGNALS = -8
  OMPI_MCA_btl = "^vader"

[parallel.MODULES]
  0_PURGE = ["--force", "purge"]
  1_NVHPC = ["load", "nvhpc/23.11"]  
  2_CUDA = ["load", "cuda/11.8"]
  3_METEO = ["load", "profile/meteo"]
  4_FFTW = ["load", "fftw/3.3.10--openmpi--4.1.6--nvhpc--23.11"]
  5_NETCDF = ["load", "netcdf-fortran/4.6.1--openmpi--4.1.6--nvhpc--23.11"]
  #_HDF5 = ["load", "hdf5/1.12.2--openmpi--4.1.4--nvhpc--23.1"]


[serial]
  NPROC = 1
  NPROCX = 1
  NPROCY = 1
  SCHOST = "hpc"
  tasks = ["CreateGrib", "Gmted", "Soil", "Marsprep", "E923Update"]
  WRAPPER = "srun"

[serial.BATCH]
  NAME = "#SBATCH --job-name=@TASK_NAME@"
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=1"
  QOS = "#SBATCH --qos=nf"
  WALLTIME = "#SBATCH --time=00:15:00"

[serial.ENV]
  DR_HOOK_IGNORE_SIGNALS = -1
  OMP_NUM_THREADS = 1
  OMPI_MCA_btl = "^vader"

[serial.MODULES]
  0_PURGE = ["--force", "purge"]
  1_NVHPC = ["load", "nvhpc/23.11"]  
  2_CUDA = ["load", "cuda/11.8"]
  3_METEO = ["load", "profile/meteo"]
  4_FFTW = ["load", "fftw/3.3.10--openmpi--4.1.6--nvhpc--23.11"]
  5_NETCDF = ["load", "netcdf-fortran/4.6.1--openmpi--4.1.6--nvhpc--23.11"]
  #_HDF5 = ["load", "hdf5/1.12.2--openmpi--4.1.4--nvhpc--23.1"]


[task]
  wrapper = ""

[task_exceptions.ArchiveHour.BATCH]
  WALLTIME = "#SBATCH --time=03:00:00"

[task_exceptions.ArchiveStatic.BATCH]
  WALLTIME = "#SBATCH --time=03:00:00"

[task_exceptions.c903]
  NPROC = 32

[task_exceptions.c903.BATCH]
  MEM = "#SBATCH --mem=200GB"
  NODE = "#SBATCH --nodes=12"
  NTASKS = "#SBATCH --ntasks=36"
  WALLTIME = "#SBATCH --time=00:30:00"

[task_exceptions.creategrib]
  binary = "gl_20230823"
  bindir = "/home/snh02/work/gl_binaries"

[task_exceptions.CreateGrib.BATCH]
  WALLTIME = "#SBATCH --time=01:00:00"

[task_exceptions.E923Update]
  bindir = "/home/snh02/work/fa_sfx2clim/"

[task_exceptions.E923Update.ENV]
  LD_LIBRARY_PATH = "$LD_LIBRARY_PATH:/home/snh02/opt/install/eccodes-2.32.1/lib64:/perm/rme/packages/auxlibs/3.7/INTEL/2021.4/lib"

[task_exceptions.E923Update.MODULES]
  OPENMPI = ["load", "openmpi/4.1.1"]

[task_exceptions.e927]
  NPROC = 16

[task_exceptions.e927.BATCH]
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=16"

[task_exceptions.Forecast]
  NPROC = 8
  NPROC_IO = 0
  WRAPPER = "ulimit -s unlimited; srun -n @NPROC@ ./select_gpu"

[task_exceptions.Forecast.BATCH]
  #  MEM = "#SBATCH --mem=200GB"
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=8"
  WALLTIME = "#SBATCH --time=00:29:00"
  PARTITION="#SBATCH -p boost_usr_prod"
  QOS="#SBATCH --qos boost_qos_dbg"
  ACCOUNT="#SBATCH -A deste_340_24 "

[task_exceptions.Forecast.ENV]
  RTTOV_COEFDIR = "/hpcperm/snh02/DEODE/satellite/rtcoef_rttov12/harm_coef/"
  UCX_LOG_LEVEL = "error"

  NOUTPUT = 2
[task_exceptions.Gmted.MODULES]
  GDAL = ["load", "gdal/3.6.2"]

[task_exceptions.Marsprep.BATCH]
  MEM = "#SBATCH --mem=0GB"
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=1"
  QOS = "#SBATCH --qos=np"
  WALLTIME = "#SBATCH --time=01:00:00"

[task_exceptions.Marsprep.ENV]
  MARS_READANY_BUFFER_SIZE = 17893020000

[task_exceptions.Pgd]
  WRAPPER = "srun -n @NPROC@"

[task_exceptions.Pgd.BATCH]
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=2"
  WALLTIME = "#SBATCH --time=00:30:00"

[task_exceptions.PgdUpdate]
  binary = "gl_20230823"
  bindir = "/home/snh02/work/gl_binaries"

[task_exceptions.Prep]
  WRAPPER = "srun -n @NPROC@"

[task_exceptions.Prep.BATCH]
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=1"
  WALLTIME = "#SBATCH --time=00:10:00"

[task_exceptions.Soil.MODULES]
  GDAL = ["load", "gdal/3.6.2"]
