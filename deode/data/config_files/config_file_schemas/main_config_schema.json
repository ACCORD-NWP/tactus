{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Config",
  "description": "Model for validation of `deode`'s main config file.",
  "type": "object",
  "additionalProperties": true,
  "properties": {
    "general": {
      "$ref": "#/definitions/general"
    },
    "suite_control": {
      "$ref": "#/definitions/suite_control"
    },
    "system": {
      "$ref": "#/definitions/system"
    },
    "boundaries": {
      "$ref": "#/definitions/boundaries"
    },
    "pgd": {
      "$ref": "#/definitions/pgd"
    },
    "fullpos": {
      "$ref": "#/definitions/fullpos"
    },
    "troika": {
      "$ref": "#/definitions/troika"
    },
    "include": {
      "$ref": "#/definitions/include"
    }
  },
  "required": [
    "general"
  ],
  "definitions": {
    "include": {
      "title": "Include Section",
      "description": "Sections to be included from other config files. Specified as 'key = val' pairs, where the keys are the section names and the vals are the paths to the files containing them.",
      "type": "object",
      "properties": {}
    },
    "troika": {
      "title": "Troika",
      "description": "DEODE system specific path settings",
      "type": "object",
      "properties": {
        "config_file": {
          "type": "string",
          "description": "Troika config file",
          "default": "@DEODE_HOME@/deode/data/config_files/troika.yml"
	}
      }
    },
    "boundaries": {
      "title": "Boundary Section",
      "description": "Settings for control of boundary treatment.",
      "type": "object",
      "properties": {
        "bdstrategy": {
          "title": "Boundary strategy",
          "default": "same_forecast",
          "type": "string",
          "enum": [
            "same_forecast"
          ]
        },
        "bdint": {
          "description": "Boundary interval",
          "type": "string",
          "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
        },
        "bdshift": {
          "description": "Shift of boundary initial time. E.g. 'PT3H' would mean use 3H old boundaries",
          "type": "string",
          "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
        },
        "bdcycle": {
          "description": "Boundary model cycle interval",
          "type": "string",
          "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
        },
        "bdtasks_per_batch": {
          "description": "Max number of parallel boundary interpolation tasks",
          "type": "number"
        },
        "bdmodel": {
          "description": "Coupling model",
          "enum": [
            "ALARO",
            "AROME",
            "IFS"
          ],
          "type": "string"
        },
	"humi_gp": {
	  "type": "boolean",
	  "description" : "Value of TFP_Q%LLGP in domain namelist for c903. True for gridpoint humidity."
	}, 
	"ifs.selection": {
            "type": "string",
            "description": "Selection",
            "enum": [
            "HRES",
            "ATOS_DT",
            "DT12",
	    "i5qp",
	    "i7u4",
	    "i7ye",
            "IFSENS",
            "PARIS_RDP"
          ]
        },
	"ifs.bdmember": {
	    "type": "string",
	    "description": "The number of member in ensamble if selection is IFSENS, else empty string."
	},
        "bd_has_surfex": {
          "description": "Set to true if the host model runs with surfex",
          "type": "boolean"
        }
      }
    },
    "pgd": {
      "title": "Pgd Section",
      "description": "Settings for control of Pgd selection.",
      "type": "object",
      "properties": {
        "one_decade": {
          "title": "Option for using one decade",
          "type": "boolean",
	  "default": true
        },
        "use_osm": {
          "title": "Option to use Open Street map input data",
          "type": "boolean",
	  "default": false
        }
      }
    },
    "fullpos": {
      "title": "Fullpos Section",
      "description": "Settings for control of fullpos selection.",
      "type": "object",
      "properties": {
        "config_path": {
          "title": "Path to fullpos config files",
          "type": "string"
        },
        "selection": {
          "description": "List of rules and selections to include",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "suite_control": {
      "title": "Suite control",
      "description": "Suite control options",
      "type": "object",
      "properties": {
        "do_soil": {
          "description": "Activate preparation of SOILGRID data as input for PGD",
          "type": "boolean"
        },
        "do_pgd": {
          "description": "Activate generation of a PGD file",
          "type": "boolean"
        },
        "do_prep": {
          "description": "Run prep if cold start",
          "type": "boolean"
        },
	"mode": {
	  "description": "Choose a strategy to achieve initial/initial_sfx files (start:  start from interpolated files and then propagate the FG between cycles, restart: start from a previous run and then propagate the FG between cycles, cold_start: always start from interpolated files).",
	  "type": "string",
	  "enum": [
	    "start",
	    "restart",
	    "cold_start"
	   ]
	},
        "interpolate_boundaries": {
          "description": "Activates the boundary interpolation",
          "type": "boolean"
        },
        "do_marsprep": {
          "description": "Run marsprep or skip extraction",
          "type": "boolean"
        },
        "do_extractsqlite": {
          "description": "Activates extraction of selected points to SQLite files for verification.",
          "type": "boolean"
        },
        "create_static_data": {
          "description": "Activate the generation of PGD and monthly climate files in the suite",
          "type": "boolean"
        },
        "create_time_dependent_suite": {
          "description": "Activate the time dependent part of the suite",
          "type": "boolean"
        }
      }
    },
    "system": {
      "title": "System",
      "description": "DEODE system specific path settings",
      "type": "object",
      "properties": {
        "bdfile_sfx_template": {
          "type": "string",
          "description": "Name template for input initial surfex file for prep"
        },
        "bdfile_template": {
          "type": "string",
          "description": "Name template for input boundary files"
        },
        "bddir_sfx": {
          "type": "string",
          "description": "Location of input intial file for surfex"
        },
        "bddir": {
          "type": "string",
          "description": "Location of input boundaries"
        },
        "intp_bddir": {
          "type": "string",
          "description": "Location of boundaries on the current domain, i.e. the output directory of e927",
          "default": "@WRK@"
	},
        "climdir": {
          "type": "string",
          "description": "Location of generated/used climate files (PGD/monthly files)"
        },
        "bindir": {
          "type": "string",
          "description": "Location of binaries"
        },
        "bdclimdir": {
          "type": "string",
          "description": "Location of host model climate files used for e927/c903"
        },
        "wrk": {
          "type": "string",
          "description": "Location of date specific working directory",
          "default": "@CASEDIR@/@YYYY@@MM@@DD@_@HH@@mm@/"
        },
        "fullpos_config_file": {
          "type": "string",
          "description": "Path to the fullpos yml config file"
        },
        "archive_timestamp": {
          "type": "string",
          "description": "Relative path of date specific archive",
          "default": "@YYYY@/@MM@/@DD@/@HH@/"
	},
        "archive": {
          "type": "string",
          "description": "Absolute path of date specific archive",
          "default": "@ARCHIVE_ROOT@/@ARCHIVE_TIMESTAMP@"
	},
        "logs": {
          "type": "string",
          "description": "Location of collected logfiles"
        },
        "namelists": {
          "type": "string",
          "description": "Path to static namelists",
          "default": "@DEODE_HOME@/deode/data/namelists/@CYCLE@"
        },
        "marsdir": {
          "type": "string",
          "description": "Location input files extracted from MARS by Marsprep"
        },
        "global_sfcdir": {
          "type": "string",
          "description": "Path to SFC files needed for c903, which are not in MARS"
        },
        "sfx_input_defs": {
          "type": "string",
          "description": "Path to the surfex json config file",
          "default": "@DEODE_HOME@/deode/data/input/sfx_input_@CYCLE@.json"
        },
	"prev_case":{
          "description": "Name of the previous experiment",
          "type": "string",
          "default": "@CASE@"
        }
      }
    },
    "general": {
      "title": "General Section",
      "description": "Model for the 'general' section.",
      "type": "object",
      "properties": {
        "times": {
          "title": "Time-Related Entries",
          "description": "Model for the 'general.times' section.",
          "type": "object",
          "properties": {
            "forecast_range": {
              "description": "Forecast range",
              "type": "string",
              "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
            },
            "start": {
              "description": "Start",
              "type": "string",
              "format": "date-time"
            },
            "end": {
              "description": "End",
              "type": "string",
              "format": "date-time"
            },
            "list": {
              "description": "List",
              "type": "array",
              "items": {
                "type": "string",
                "format": "date-time"
              }
            },
            "cycle_length": {
              "description": "Cycle length defined as duration",
              "default": "PT3H",
              "type": "string",
              "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
            },
            "basetime": {
              "description": "Initial date and time for the current task.",
              "type": "string",
              "format": "date-time"
            },
            "validtime": {
              "description": "Final date and time for the current task.",
              "type": "string",
              "format": "date-time"
            }
          },
          "oneOf": [
	    {
            "anyOf": [
             {
              "required": [
                "start",
                "end"
              ],
              "not": {
                "required": [
                  "list"
                ]
              }
             },
	     {
              "required": [
                "basetime"
              ],
              "not": {
               "anyOf": [
		      {       
                "required": [
                  "end"
                ]
		      },
		      {       
                "required": [
                  "list"
                ]
		      },
		      {       
                "required": [
                  "start"
                ]
		      }
	       ]
              }
	     }
	    ]
            },
            {
              "required": [
                "list"
              ],
              "not": {
                "anyOf": [
                  {
                    "required": [
                      "start"
                    ]
                  },
                  {
                    "required": [
                      "end"
                    ]
                  }
                ]
              }
            }
          ]
        },
        "accept_static_namelists": {
          "description": "Allow usage of static namelists as input for the tasks. The namelist should be located in the directory specified by platform.namelists and named with the convention namelist_{kind}_{task} where kind could be surfex or master and task forecast/pgd or similar. For the extraction of namelist see [namelists.md](../docs/namelists.md).",
          "type": "boolean"
        },
        "case": {
          "description": "Experiment name",
          "default": "deode_case",
          "type": "string"
        },
        "realization": {
          "description": "Placeholder for future ensemble or similar need",
          "type": "number",
	  "default": -1
        },
        "cnmexp": {
          "description": "Experiment short name",
          "default": "DEOD",
          "type": "string",
          "minLength": 4,
          "maxLength": 4
        },
        "loglevel": {
          "description": "Logger output level",
          "type": "string",
          "enum": [
            "CRITICAL",
            "ERROR",
            "DEBUG",
            "INFO",
            "WARNING"
          ]
        },
        "surfex": {
          "description": "SURFEX switch",
          "type": "boolean"
        },
        "keep_workdirs": {
          "description": "Do not remove working directories",
          "type": "boolean"
        },
        "csc": {
          "description": "CSC",
          "default": "AROME",
          "type": "string",
          "enum": [
            "AROME",
            "ALARO",
            "HARMONIE_AROME"
          ]
        },
        "cycle": {
          "description": "IAL cycle",
          "type": "string",
          "enum": [
            "CY48t3",
            "CY46h1"
          ]
        },
        "initfile": {
          "description": "Initial file for the forecast object. Normally no need to provide unless there are special requirements or the forecast object is used in stand alone mode.",
          "type": "string"
        },
        "initfile_sfx": {
          "description": "Initial surfex file for the forecast object. Normally no need to provide unless there are special requirements or the forecast object is used in stand alone mode.",
          "type": "string"
        },
        "output_settings": {
          "title": "Output Settings",
          "description": "Output settings. Specified as duration for any of interval, endtime:interval, starttime:endtime:interval or a list of these options",
          "type": "object",
          "properties": {
            "history": {
              "description": "Output list for history files",
              "anyOf": [
	     {
                "type": "string",
                "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
	     },
	     {
                "type": "array",
                "items": {
                   "type": "string",
                   "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?:P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?:P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
                }
	     }
	      ]
            },
            "surfex": {
              "description": "Output list for surfex files",
              "anyOf": [
	     {
                "type": "string",
                "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
	     },
	     {
                "type": "array",
                "items": {
                   "type": "string",
                   "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?:P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?:P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
                }
	     }
	      ]
            },
            "fullpos": {
              "description": "Output list for fullpos files",
              "anyOf": [
	     {
                "type": "string",
                "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
	     },
	     {
                "type": "array",
                "items": {
                   "type": "string",
                   "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?:P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?:P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
                }
	     }
	      ]
            },
            "nrazts": {
              "description": "Reset times for instantaneous fluxes ( e.g. min/max temperature )",
              "anyOf": [
	     {
                "type": "string",
                "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
	     },
	     {
                "type": "array",
                "items": {
                   "type": "string",
                   "pattern": "^P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?:P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?:P(?!$)(\\d+Y)?(\\d+M)?(\\d+W)?(\\d+D)?(T(?=\\d+[HMS])(\\d+H)?(\\d+M)?(\\d+S)?)?$"
                }
	     }
	      ]
            }
          }
        },
        "windfarm": {
          "description": "Switch on wind farm parameterisation",
          "type": "boolean",
          "default": false
        }
      },
      "required": [
        "times"
      ]
    }
  }
}
