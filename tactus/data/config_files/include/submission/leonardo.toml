[submission]
  account = "#SBATCH -A DestE_330_25_0"
  bindir_gl = "@INSTALL_DIR@/gl/leonardo.cy49t2.intel/bin"
  default_submit_type = "serial"
  lfftw = false
  module_initpath = "/leonardo_work/DestE_330_25/users/SAN/install/lmod/lmod/init"
  nproma = -32

[submission.iomerge.age_limit]
  fullpos = 15
  history = 15
  surfex = 15

[submission.iomerge.files_expected]
  fullpos = 0
  history = -1
  surfex = 0

[submission.task]
  wrapper = ""

[submission.task_exceptions.ArchiveHour.BATCH]
  WALLTIME = "#SBATCH --time=03:00:00"

[submission.task_exceptions.ArchiveStatic.BATCH]
  WALLTIME = "#SBATCH --time=03:00:00"

[submission.task_exceptions.C903]
  NPROC = 36

[submission.task_exceptions.C903.BATCH]
  MEM = "#SBATCH --mem=480GB"
  NODE = "#SBATCH --nodes=6"
  TASKS_PER_NODE = "#SBATCH --ntasks-per-node=6"
  #NTASKS = "#SBATCH --ntasks=36"
  WALLTIME = "#SBATCH --time=00:30:00"

[submission.task_exceptions.CreateGrib]
  binary = "gl"
  bindir = "@BINDIR_GL@"

[submission.task_exceptions.CreateGrib.BATCH]
  WALLTIME = "#SBATCH --time=01:00:00"

[submission.task_exceptions.CreateGrib.MODULES]
  4_FFTW3 = [
    "load",
    "fftw/3.3.10--intel-oneapi-mpi--2021.10.0--oneapi--2023.2.0-sremgts ",
  ]

[submission.task_exceptions.E927]
  NPROC = 16

[submission.task_exceptions.E927.BATCH]
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=16"

[submission.task_exceptions.Forecast]
  NPROC = 32
  NPROC_IO = 0
  WRAPPER = "srun"

[submission.task_exceptions.Forecast.BATCH]
  MEM = "#SBATCH --mem=480GB"
  NODES = "#SBATCH --nodes=2"
  PARTITION = "#SBATCH --partition=dcgp_usr_prod"
  TASKS_PER_NODE = "#SBATCH --ntasks-per-node=16"
  WALLTIME = "#SBATCH --time=00:29:00"

[submission.task_exceptions.Forecast.ENV]
  NOUTPUT = 2
  RTTOV_COEFDIR = "/leonardo_work/DestE_330_25/users/SAN/static/DEODE/satellite/rtcoef_rttov12/harm_coef/"
  UCX_LOG_LEVEL = "error"

[submission.task_exceptions.InterpolSstSic]
  binary = "gl"
  bindir = "@BINDIR_GL@"

[submission.task_exceptions.Marsprep]
  bindir = "/leonardo_work/DestE_330_25/users/SAN/install/mars"
  mars_version = "7"

[submission.task_exceptions.Marsprep.BATCH]
  MEM = "#SBATCH --exclusive"
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=1"
  PARTITION = "#SBATCH --partition=dcgp_usr_prod"
  WALLTIME = "#SBATCH --time=01:00:00"

[submission.task_exceptions.Pgd]
  NPROC = 32

[submission.task_exceptions.Pgd.BATCH]
  NODES = "#SBATCH --nodes=2"
  TASKS_PER_NODE = "#SBATCH --ntasks-per-node=32"
  WALLTIME = "#SBATCH --time=03:00:00"

[submission.task_exceptions.PgdUpdate]
  binary = "gl"
  bindir = "@BINDIR_GL@"

[submission.task_exceptions.PgdUpdate.MODULES]
  4_FFTW3 = [
    "load",
    "fftw/3.3.10--intel-oneapi-mpi--2021.10.0--oneapi--2023.2.0-sremgts ",
  ]

[submission.task_exceptions.Prep.BATCH]
  NODES = "#SBATCH --nodes=3"
  TASKS_PER_NODE = "#SBATCH --ntasks-per-node=8"
  WALLTIME = "#SBATCH --time=00:10:00"

  #FIXME: This path seems to be a path on ATOS and not on LEONARDO

[submission.types.background_hpc]
  SCHOST = "localhost"
  tasks = ["Background_hpc", "UnitTest"]

[submission.types.background_vm]
  INTERPRETER = "#!/usr/bin/python3"
  SCHOST = "localhost"
  tasks = ["Background_vm"]

[submission.types.gnu]
  NPROC = 1
  NPROCX = 1
  NPROCY = 1
  SCHOST = "leonardo"
  tasks = ["ExtractSQLite"]
  WRAPPER = "srun"

[submission.types.gnu.BATCH]
  NAME = "#SBATCH --job-name=@TASK_NAME@"
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=1"
  PARTITION = "#SBATCH --partition=lrd_all_serial"
  WALLTIME = "#SBATCH --time=00:15:00"

[submission.types.gnu.MODULES]
  ECMWFTOOLBOX = ["load", "ecmwf-toolbox/2021.08.3.0"]

[submission.types.parallel]
  NPROC = 32
  SCHOST = "leonardo"
  tasks = ["Forecast", "E927", "Pgd", "Prep", "C903"]
  WRAPPER = "srun"

[submission.types.parallel.BATCH]
  NAME = "#SBATCH --job-name=@TASK_NAME@"
  PARTITION = "#SBATCH --partition=dcgp_usr_prod"
  WALLTIME = "#SBATCH --time=00:10:00"

[submission.types.parallel.ENV]
  DR_HOOK = 1
  DR_HOOK_IGNORE_SIGNALS = 8
  EC_MPI_ATEXIT = 0
  EC_PROFILE_HEAP = 0
  INPART = 0
  #KMP_MONITOR_STACKSIZE = "1G"
  #KMP_STACKSIZE = "4G"
  LLSIMPLE_DGEMM = 1
  OMP_NUM_THREADS = 1
  #OMP_STACKSIZE = "4G"
  LD_LIBRARY_PATH = "$LD_LIBRARY_PATH:/leonardo_work/DestE_330_25/users/SAN/install/eccodes-2.40.0-intel/lib64/"
  OMPI_MCA_btl = "^vader"
  PARALLEL = 0
  PERSISTENT = 0

[submission.types.parallel.MODULES]
  #0_PURGE = ["--force", "purge"]
  1_INTEL_COMPILERS = ["load", "intel-oneapi-compilers/2023.2.1"]
  2_INTEL_MPI = ["load", "intel-oneapi-mpi/2021.10.0"]
  3_INTEL_MKL = ["load", "intel-oneapi-mkl/2023.2.0"]
  4_HDF5 = [
    "load",
    "hdf5/1.14.3--intel-oneapi-mpi--2021.10.0--oneapi--2023.2.0 ",
  ]
  5_NETCDFC = [
    "load",
    "netcdf-c/4.9.2--intel-oneapi-mpi--2021.10.0--oneapi--2023.2.0",
  ]
  6_NETCDFF = [
    "load",
    "netcdf-fortran/4.6.1--intel-oneapi-mpi--2021.10.0--oneapi--2023.2.0",
  ]
  7_FFTW3 = [
    "load",
    "fftw/3.3.10--intel-oneapi-mpi--2021.10.0--oneapi--2023.2.0-sremgts ",
  ]

[submission.types.serial]
  NPROC = 1
  NPROCX = 1
  NPROCY = 1
  SCHOST = "leonardo"
  tasks = [
    "CreateGrib",
    "Topography",
    "Soil",
    "Marsprep",
    "E923Update",
    "InterpolSstSic",
    "GenerateWfpTabFile",
  ]
  WRAPPER = "srun"

[submission.types.serial.BATCH]
  NAME = "#SBATCH --job-name=@TASK_NAME@"
  NODES = "#SBATCH --nodes=1"
  NTASKS = "#SBATCH --ntasks=1"
  PARTITION = "#SBATCH --partition=lrd_all_serial"
  WALLTIME = "#SBATCH --time=00:15:00"

[submission.types.serial.ENV]
  DR_HOOK_IGNORE_SIGNALS = -1
  LD_LIBRARY_PATH = "$LD_LIBRARY_PATH:/leonardo_work/DestE_330_25/users/SAN/install/eccodes-2.40.0-intel/lib64/"
  OMP_NUM_THREADS = 1
  OMPI_MCA_btl = "^vader"

[submission.types.serial.MODULES]
  #0_PURGE = ["--force", "purge"]
  1_INTEL_COMPILERS = ["load", "intel-oneapi-compilers/2023.2.1"]
  2_INTEL_MPI = ["load", "intel-oneapi-mpi/2021.10.0"]
  3_INTEL_MKL = ["load", "intel-oneapi-mkl/2023.2.0"]
  4_NETCDFC = [
    "load",
    "netcdf-c/4.9.2--intel-oneapi-mpi--2021.10.0--oneapi--2023.2.0",
  ]
  6_NETCDFF = [
    "load",
    "netcdf-fortran/4.6.1--intel-oneapi-mpi--2021.10.0--oneapi--2023.2.0",
  ]
